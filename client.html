<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Chat Uygulaması</title>
<style>
#chat { border:1px solid #333; height:200px; overflow-y:auto; padding:5px; }
#users { border:1px solid #333; height:100px; overflow-y:auto; padding:5px; }
</style>
</head>
<body>

<h2>Chat Uygulaması</h2>

<div id="loginDiv">
  <input id="username" placeholder="Kullanıcı adı">
  <input id="password" type="password" placeholder="Şifre">
  <button id="btnRegister">Kayıt Ol</button>
  <button id="btnLogin">Giriş Yap</button>
  <p id="status"></p>
</div>

<div id="chatDiv" style="display:none;">
  <div id="users"></div>
  <div id="chat"></div>
  <input id="msg" placeholder="Mesaj yaz">
  <button id="btnSend">Gönder</button>
</div>

<script>
const ws = new WebSocket("ws://25.21.35.47");

const chat = document.getElementById("chat");
const usersDiv = document.getElementById("users");
const status = document.getElementById("status");

document.getElementById("btnRegister").addEventListener("click", register);
document.getElementById("btnLogin").addEventListener("click", login);
document.getElementById("btnSend").addEventListener("click", send);

function register() {
    const u = document.getElementById("username").value;
    const p = document.getElementById("password").value;
    ws.send(JSON.stringify({action:"register", username:u, password:p}));
}

function login() {
    const u = document.getElementById("username").value;
    const p = document.getElementById("password").value;
    ws.send(JSON.stringify({action:"login", username:u, password:p}));
}

function send() {
    const text = document.getElementById("msg").value;
    if(text.trim() === "") return;
    ws.send(JSON.stringify({action:"message", text:text}));
    document.getElementById("msg").value = "";
}

ws.onmessage = e => {
    const data = JSON.parse(e.data);

    if(data.action === "register"){
        status.textContent = data.success ? "Kayıt başarılı!" : "Kullanıcı zaten var!";
    }

    if(data.action === "login"){
        if(data.success){
            status.textContent = "Giriş başarılı!";
            document.getElementById("loginDiv").style.display = "none";
            document.getElementById("chatDiv").style.display = "block";
        } else {
            status.textContent = "Kullanıcı adı veya şifre hatalı!";
        }
    }

    if(data.action === "message"){
        chat.innerHTML += `<p><b>${data.from}:</b> ${data.text}</p>`;
        chat.scrollTop = chat.scrollHeight;
    }

    if(data.action === "online"){
        usersDiv.innerHTML = "<b>Online Kullanıcılar:</b><br>" + data.users.join("<br>");
    }
};
</script>

</body>
</html>
